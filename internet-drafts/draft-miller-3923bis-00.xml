<?xml version="1.0"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc compact="yes"?>
<?rfc strict="yes"?>
<?rfc symrefs="yes"?>
<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<rfc category="std" docName="draft-miller-rfc3923bis-00" ipr="trust200902" obsoletes="3923">

  <front>
    <title abbrev="XMPP E2E">End-to-End Object Encryption for the Extensible Messaging and Presence Protocol (XMPP)</title>
    <author initials="M." surname="Miller" fullname="Matthew Miller">
      <organization>Cisco</organization>
      <address>
        <email>mamille2@cisco.com</email>
      </address>
    </author>
    <date day="26" month="February" year="2010"/>
    <area>Applications</area>
    <keyword>Internet-Draft</keyword>
    <keyword>XMPP</keyword>
    <keyword>Extensible Messaging and Presence Protocol</keyword>
    <keyword>Jabber</keyword>
    <abstract>
      <t>This document defines a method of end-to-end object encryption for the Extensible Messaging and Presence Protocol (XMPP).  The protocol defined herein is a simplified version of the protocol defined in RFC 3923.</t>
    </abstract>
  </front>

  <middle>

    <section title="Introduction" anchor="intro">
      <t>This memo defines methods of end-to-end object encryption for the Extensible Messaging and Presence Protocol (XMPP).  (For information about XMPP, see <xref target="XMPP-CORE"/> and <xref target="XMPP-IM"/>.)  The method specified herein enables a sender to encrypt an instant message sent to a specific recipient, and sign and/or encrypt any arbitrary XMPP stanza directed to a specific user.</t>
      <section title="Terminology" anchor="intro-terms">
        <t>This document inherits terminology defined in <xref target="XMPP-CORE"/>.</t>
        <t>The capitalized key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <xref target="TERMS">BCP 14, RFC 2119</xref>.</t>
      </section>
    </section>


    <section title='Securing XMPP Stanzas' anchor='stanza'>
      <t>The process a sending agent follows for securing stanzas is very similar regardless of the form of stanza (e.g. &lt;iq/&gt;, &lt;message/&gt;, and &lt;presence/&gt; from <xref target="XMPP-IM"/>).</t>
      <t><list style="numbers">
        <t>Constructs a cleartext version of the stanza, S.</t>
        <t>Notes the current date and time when this stanza is constructed, formatted as per <xref target="DATETIME"/>, N.</t>
        <t>Converts the stanza to a UTF-8 encoded string, optionally removing line breaks and other insignificant whitespace between elements and attributes i.e., UTF8-encode(S) = S'. We call S' a "stanza-string" because it for purposes of encryption and decryption it is not treated as XML but as an opaque string.</t>
        <t>Creates a Message Authentication Code "M" for stanza-string S' using <xref target="HMAC"/>. The algorithm is SHA256 and the sender's public key (R) is the secret.  The input to HMAC-SHA256 MUST be the timestamp from step 2 (conforming to <xref target='DATETIME'/>) appended by the cleartext sanza-string S', as follows:
        <figure>
          <artwork><![CDATA[
HMAC-SHA256( SHA256(R), UTF8-encode(N+S') )
          ]]></artwork>
        </figure></t>
        <t>Prepends M (which will be 32 octets in length) to the stanza-string S' to create a bytestring B.</t>
        <t>Encrypts the bytestring B using the recipient's public key to produce encrypted data T.</t>
        <t>Base64-encodes T to produce the encrypted data T'.</t>
        <t>Constructs a &lt;e2e&gt; element qualified by the "urn:ietf:params:xml:ns:xmpp-objenc" namespace, with the attribute 'stamp' set to the timestamp N from step 2, and T' as the text content.</t>
        <t>Sends the &lt;e2e/&gt; element as the payload to a stanza of the same form from step 1.</t>
      </list></t>

      <section title='Example of Securing Messages' anchor="message">
        <t>The sender begins with the cleartext version of the &lt;message/&gt; stanza "S":</t>
        <figure>
          <artwork><![CDATA[
<message    xmlns='jabber:client'
            from='juliet@capulet.net/balcony'
            id='183ef129'
            to='romeo@montegue.net'
            type='chat'>
    <thread>8996aef0-061d-012d-347a-549a200771aa</thread>
    <body>Wherefore art thou, Romeo?</body>
</message>
          ]]></artwork>
        </figure>
        <t>The Message Authentication Code is constructed from:</t>
        <figure>
          <artwork><![CDATA[
2010-02-28T18:00:00Z<message xmlns='jabber:client' from='juliet@capulet.net/balcony' id='183ef129' to='romeo@montegue.net' type='chat'><thread>8996aef0-061d-012d-347a-549a200771aa</thread><body>Wherefore art thou, Romeo?</body></message>
          ]]></artwork>
        </figure>
        <t>The sender then performs the steps from above, and sends the following:</t>
        <figure>
          <artwork><![CDATA[
<message  xmlns='jabber:client'
          from='juliet@capulet.net/balcony'
          id='6410ed123'
          to='romeo@montegue.net'
          type='chat'>
  <thread>460f0da0-0628-012d-347b-549a200771aa</thread>
  <e2e  xmlns='urn:ietf:params:xml:ns:xmpp-objenc'
        stamp='2010-02-28T18:00:00Z'>
    oOb/huFlvC17+XxZdye4BAj4jN2yWiSQZts7BctqZB+wo1tCfHE0w
    BMQlof4\nC7KLn6+ktILqX6k5/IgQrwGF0hxKjFk44R01RcVmzlUS
    0HaSEIQVQk/3r33c\n3/NKzN8Cq+yzZKfP/p3KkpHMixCUTEe7B38
    Eu9h5hfs8PgXkb/GAdw7Ea/qW\nQgRjYcNl7jcplYY/FQQTEEfQoc
    fKCbm/RaOsRSMnqGjkqGGt6+yQGWtvzSS2\nHD4/EHGV62IGz/sQH
    5cAvloA9LqfiNh/oEm/UD2iLTAVj1BBS+WJZqMRznAJ\nNM4gF8vF
    nDdLAMyeMZedlrHCS4lp6PzeblDD0Jk2HQ==
  </e2e>
</message>
          ]]></artwork>
        </figure>
        <t>NOTE: The sender SHOULD include a &lt;thread/&gt; with each chat to maintain conversation continuity.</t>
      </section>
    </section>

    <section title="Rules for S/MIME Generation and Handling" anchor="rules">
      <section title="Certificate Enrollment" anchor="rules-enroll">
        <t><xref target="SMIME"/> does not specify how to obtain a certificate from a certificate authority, but instead mandates that every sending agent must already have a certificate.  The PKIX Working Group has, at the time of this writing, produced two separate standards for certificate enrollment: <xref target="CMP"/> and <xref target="CMC"/>.  Which method to use for certificate enrollment is outside the scope of this memo.</t>
      </section>
      <section title="Certificate Retrieval" anchor="rules-retrieve">
        <t>A receiving agent MUST provide some certificate retrieval mechanism in order to gain access to certificates for recipients of digital envelopes.  This memo does not address how S/MIME agents handle certificates, only what they do after a certificate has been validated or rejected.  S/MIME certification issues are covered in <xref target="CERT"/>.</t>
        <t>However, at a minimum, for initial S/MIME deployment, a user agent SHOULD automatically generate a message to an intended recipient requesting that recipient's certificate in a signed return message.  Receiving and sending agents SHOULD also provide a mechanism to allow a user to "store and protect" certificates for correspondents in such a way so as to guarantee their later retrieval.</t>
      </section>
      <section title="Certificate Names" anchor="rules-names">
        <t>End-entity certificates used by XMPP entities in the context of this memo SHOULD contain a valid instant messaging and presence address.  The address SHOULD be specified as both an 'im:' URI (for instant messaging, as defined in <xref target="CPIM"/>) and a 'pres:' URI (for presence, as defined in <xref target="CPP"/>); each of these URIs SHOULD be specified in a separate GeneralName entry of type uniformResourceIdentifier inside the subjectAltName (i.e., two separate entries).  Information in the subject distinguished name SHOULD be ignored.</t>
        <t>Each URI MUST be of the form &lt;im:address&gt; or &lt;pres:address&gt;, where the "address" portion is an XMPP address (also referred to as a Jabber Identifier or JID) as defined in <xref target="XMPP-CORE"/>, prepended with the 'im:' or 'pres:' URI scheme.  The address SHOULD be of the form &lt;node@domain&gt; (i.e., a "bare JID"), although any valid JID form MAY be used.</t>
        <t>The value of the JID contained in the XMPP 'from' attribute MUST match a JID provided in the signer's certificate, with the exception that the resource identifier portion of the JID contained in the 'from' attribute SHOULD be ignored for matching purposes.</t>
        <t>Receiving agents MUST check that the sending JID matches a JID provided in the signer's certificate, with the exception that the resource identifier portion of the JID contained in the 'from' attribute SHOULD be ignored for matching purposes.  A receiving agent SHOULD provide some explicit alternate processing of the stanza if this comparison fails, which may be to display a message informing the recipient of the addresses in the certificate or other certificate details.</t>
        <t>The subject alternative name extension is used in S/MIME as the preferred means to convey the instant messaging and presence address that corresponds to the entity for this certificate.  Any XMPP address present in the certificate MUST be encoded using the ASN.1 Object Identifier "id-on-xmppAddr" as specified in Section 5.1.1 of <xref target="XMPP-CORE"/>.</t>
      </section>
      <section title="Transfer Encoding" anchor="rules-transfer">
        <t>Because it is expected that XMPP applications will not interface with older 7-bit systems, the transfer encoding (as defined in Section 3.1.2 of <xref target="SMIME"/>) MUST be "binary".</t>
      </section> 
      <section title="Decryption" anchor="rules-decrypt">
        <t>If the receiving agent is unable to decrypt the encrypted XML stanza, it SHOULD NOT present the stanza to the intended recipient (human or application), SHOULD provide some explicit alternate processing of the stanza (which may be to display a message informing the recipient that it has received a stanza that cannot be decrypted), and MAY return a stanza error to the sender as described under <xref target="errors">Recipient Error Handling</xref>.</t>
      </section>
      <section title="Inclusion and Checking of Timestamps" anchor="rules-timestamps">
        <t>TODO: rework to something supporting offline usage</t>
        <t>Timestamps are included in "Message/CPIM" and "application/pidf+xml" objects to help prevent replay attacks.  All timestamps MUST conform to <xref target='DATETIME'/> and be presented as UTC with no offset, including fractions of a second as appropriate.  Absent a local adjustment to the sending agent's perceived time or the underlying clock time, the sending agent MUST ensure that the timestamps it sends to the receiver increase monotonically (if necessary by incrementing the seconds fraction in the timestamp if the clock returns the same time for multiple requests).  The following rules apply to the receiving application:</t>
        <t><list style="symbols">
          <t>It MUST verify that the timestamp received is within five minutes of the current time.</t>
          <t>It SHOULD verify that the timestamp received is greater than any timestamp received in the last 10 minutes which passed the previous check.</t>
          <t>If any of the foregoing checks fails, the timestamp SHOULD be presented to the receiving entity (human or application) marked as "old timestamp", "future timestamp", or "decreasing timestamp", and the receiving entity MAY return a stanza error to the sender as described under <xref target="errors">Recipient Error Handling</xref>.</t>
        </list></t>
      </section>
      <section title="Mandatory-to-Implement Cryptographic Algorithms" anchor="rules-mandatory">
        <t>All implementations MUST support the following algorithms.  Implementations MAY support other algorithms as well.</t>
        <t>For CMS SignedData:</t>
        <t><list style='symbols'>
          <t>The SHA-1 message digest as specified in <xref target="CMS-ALG"/> section 2.1.</t>
          <t>The RSA (PKCS #1 v1.5) with SHA-1 signature algorithm, as specified in <xref target="CMS-ALG"/> section 3.2.</t>
        </list></t>
        <t>For CMS EnvelopedData:</t>
        <t><list style='symbols'>
          <t>The RSA (PKCS #1 v1.5) key transport, as specified in <xref target="CMS-ALG"/> section 4.2.1.</t>
          <t>The AES-128 encryption algorithm in CBC mode, as specified in <xref target="CMS-AES"/>.</t>
        </list></t>
      </section>
    </section>

    <section title="Recipient Error Handling" anchor="errors">
      <t>When an XMPP entity receives an XML stanza containing data that is signed and/or encrypted using the protocol described herein, several scenarios are possible:</t>
      <t><list style='hanging'>
        <t hangText='Case #1:'>The receiving application does not understand the protocol.</t>
        <t hangText='Case #2:'>The receiving application understands the protocol and is able to decrypt the payload.</t>
        <t hangText='Case #3:'>The receiving application understands the protocol and is able to decrypt the payload, but the timestamps fail the checks specified above under <xref target="rules-timestamps">Checking of Timestamps</xref>.</t>
         <t> hangText='Case #4:'>The receiving application understands the protocol but is unable to decrypt the payload.</t>
      </list></t>
      <t>In Case #1, the receiving application MUST do one and only one of the following: (1) ignore the &lt;e2e/&gt; extension, (2) ignore the entire stanza, or (3) return a &lt;service-unavailable/&gt; error to the sender, as described in <xref target="XMPP-CORE"/>.</t>
      <t>In Case #2, the receiving application MUST NOT return a stanza error to the sender, since this is the success case.</t>
      <t>In Case #3, the receiving application MAY return a &lt;not-acceptable/&gt; error to the sender (as described in <xref target="XMPP-CORE"/>), optionally supplemented by an application-specific error condition element &lt;bad-timestamp/&gt; as shown below:</t>
      <figure>
        <preamble>Example 16: Recipient returns &lt;not-acceptable/&gt; error:</preamble>
        <artwork><![CDATA[
<message from='romeo@example.net/orchard' type='chat'>
  <e2e xmlns='urn:ietf:params:xml:ns:xmpp-objenc'>
  [CDATA section here]
  </e2e>
  <error type='modify'>
    <not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/>
    <bad-timestamp xmlns='urn:ietf:params:xml:xmpp-e2e'/>
  </error>
</message>
        ]]></artwork>
      </figure>
      <t>In Case #4, the receiving application SHOULD return a &lt;bad-request/&gt; error to the sender (as described in <xref target="XMPP-CORE"/>), optionally supplemented by an application-specific error condition element &lt;decryption-failed/&gt; as shown below:</t>
      <figure>
        <preamble>Example 18: Recipient returns &lt;bad-request/&gt; error:</preamble>
        <artwork><![CDATA[
<message from='romeo@example.net/orchard' type='chat'>
  <e2e xmlns='urn:ietf:params:xml:ns:xmpp-objenc'>
  [CDATA section here]
  </e2e>
  <error type='modify'>
    <bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/>
    <decryption-failed xmlns='urn:ietf:params:xml:xmpp-e2e'/>
  </error>
</message>
        ]]></artwork>
      </figure>
    </section>

    <section title='urn:ietf:params:xml:xmpp-e2e Namespace' anchor='namespace'>
      <t>The &lt;e2e xmlns='urn:ietf:params:xml:ns:xmpp-objenc'/&gt; element is a wrapper for an XML CDATA section (see Section 2.7 of <xref target="XML"/>) that contains a "Message/CPIM", "application/pidf+xml", or "application/xmpp+xml" object. Thus the 'urn:ietf:params:xml:xmpp-e2e' namespace has no inherent semantics, and the semantics of the encapsulated object are defined by one of the following specifications:</t>
      <t><list style="symbols">
        <t><xref target="MSGFMT"/> for "Message/CPIM"</t>
        <t><xref target="PIDF"/> for "application/pidf+xml"</t>
        <t><xref target="XMPP-CORE"/> for "application/xmpp+xml"</t>
      </list></t>
      <t>Although the "application/xmpp+xml" media type is specified in this document, the &lt;xmpp/&gt; element is simply a wrapper for a &lt;message/&gt;, &lt;presence/&gt;, or &lt;iq/&gt; stanza, where the semantics of those stanza types are specified in <xref target="XMPP-CORE"/>.</t>
      <t>Given that the 'urn:ietf:params:xml:ns:xmpp-objenc' namespace has no inherent semantics and specifies a using protocol only, versioning is the responsibility of the protocols that define the encapsulated objects (<xref target="MSGFMT"/>, <xref target="PIDF"/>, and <xref target="XMPP-CORE"/>).</t>
    </section>

    <section title='Security Considerations' anchor='security'>
      <t>This entire memo discusses security.  Detailed security considerations for instant messaging and presence protocols are given in <xref target='IMP-REQS'/> (Sections 5.1 through 5.4), and for XMPP in particular are given in <xref target="XMPP-CORE"/> (Sections 12.1 through 12.6).  In addition, all of the security considerations specified in <xref target="XML-MEDIA"/> apply to the "application/xmpp+xml" media type.</t>
      <t>The end-to-end security method defined here MAY result in exchanging secured instant messages and presence information through a gateway that implements the CPIM specifications.  Such a gateway MUST be compliant with the minimum security requirements of the instant messaging and presence protocols with which it interfaces.</t>
    </section>

    <section title="IANA Considerations" anchor="iana">
      <section title="XML Namespace Name for e2e Data in XMPP" anchor="iana-ns-e2e">
        <t>A URN sub-namespace of signed and encrypted content for the Extensible Messaging and Presence Protocol (XMPP) is defined as follows. (This namespace name adheres to the format defined in <xref target='XML-REG'/>.)</t>
        <t><list style='hanging'> 
          <t hangText='URI:'>urn:ietf:params:xml:ns:xmpp-objenc</t> 
          <t hangText='Specification:'>RFC 3923</t>
          <t hangText='Description:'>This is an XML namespace name of signed and encrypted content for the Extensible Messaging and Presence Protocol as defined by RFC 3923.</t>
          <t hangText='Registrant Contact:'>IESG, &lt;iesg@ietf.org&gt;</t> 
        </list></t>
      </section>
      <section title='Content-type Registration for "application/xmpp+xml"' anchor="iana-ns-xmpp">
        <t>To: ietf-types@iana.org</t>
        <t>Subject: Registration of MIME media type application/xmpp+xml</t>
        <t><list style='hanging'>
          <t hangText="MIME media type name: application"></t>
          <t hangText="MIME subtype name: xmpp+xml"></t>
          <t hangText="Required parameters: (none)"></t>
          <t hangText="Optional parameters: (charset)">Same as charset parameter of application/xml as specified in RFC 3023; per Section 11.5 of <xref target="XMPP-CORE"/>, the charset must be UTF-8.</t>
          <t hangText="Encoding considerations:">Same as encoding considerations of application/xml as specified in RFC 3023; per Section 11.5 of <xref target="XMPP-CORE"/>, the encoding must be UTF-8.</t>
          <t hangText="Security considerations:">All of the security considerations specified in RFC 3023 and <xref target="XMPP-CORE"/> apply to this XML media type.  Refer to <xref target="security"/> of RFC 3923.</t>
          <t hangText="Interoperability considerations: (none)"></t>
          <t hangText="Specification:">RFC 3923</t>
          <t hangText="Applications which use this media type:">XMPP-compliant instant messaging and presence systems.</t>
          <t hangText="Additional information: (none)"></t>
          <t hangText="Person and email address to contact for further information:">IESG, &lt;iesg@ietf.org&gt;</t>
          <t hangText="Intended usage:">COMMON</t>
          <t hangText="Author/Change controller:">IETF, XMPP Working Group</t>
        </list></t>
      </section>
    </section>

  </middle>

  <back>

    <references title="Normative References">

<reference anchor='CERT'>
<front>
<title>Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 3.1 Certificate Handling</title>
<author initials='B.' surname='Ramsdell' fullname='B. Ramsdell'>
<organization /></author>
<date year='2004' month='July' /></front>
<seriesInfo name='RFC' value='3850' />
<format type='TXT' octets='37446' target='ftp://ftp.isi.edu/in-notes/rfc3850.txt' />
</reference>

<reference anchor='CMS'>
<front>
<title>Cryptographic Message Syntax (CMS)</title>
<author initials='R.' surname='Housley' fullname='R. Housley'>
<organization /></author>
<date year='2004' month='July' /></front>
<seriesInfo name='RFC' value='3852' />
<format type='TXT' octets='15541' target='ftp://ftp.isi.edu/in-notes/rfc3852.txt' />
</reference>

<reference anchor='CMS-AES'>
<front>
<title>Use of the Advanced Encryption Standard (AES) Encryption Algorithm in Cryptographic Message Syntax (CMS)</title>
<author initials='J.' surname='Schaad' fullname='J. Schaad'>
<organization /></author>
<date year='2003' month='July' /></front>
<seriesInfo name='RFC' value='3565' />
<format type='TXT' octets='26773' target='ftp://ftp.isi.edu/in-notes/rfc3565.txt' />
</reference>

<reference anchor='CMS-ALG'>
  <front>
    <title>Cryptographic Message Syntax (CMS) Algorithms</title>
    <author initials='R.' surname='Housley' fullname='R.  Housley'><organization /></author>
    <date month='August' year='2002' />
  </front>
  <seriesInfo name='RFC' value='3370' />
  <format type='TXT' octets='51001' target='ftp://ftp.isi.edu/in-notes/rfc3370.txt' />
</reference>

<reference anchor="CPIM">
<front>
<title>Common Profile for Instant Messaging (CPIM)</title>
<author initials='J.' surname='Peterson' fullname='J. Peterson'>
<organization /></author>
<date year='2004' month='August' /></front>
<seriesInfo name='RFC' value='3860' />
<format type='TXT' octets='26486' target='ftp://ftp.isi.edu/in-notes/rfc3860.txt' />
</reference>

<reference anchor="CPP">
<front>
<title>Common Profile for Presence (CPP)</title>
<author initials='J.' surname='Peterson' fullname='J. Peterson'>
<organization /></author>
<date year='2004' month='August' /></front>
<seriesInfo name='RFC' value='3859' />
<format type='TXT' octets='30537' target='ftp://ftp.isi.edu/in-notes/rfc3859.txt' />
</reference>

<reference anchor='DATETIME'>
<front>
<title>Date and Time on the Internet: Timestamps</title>
<author initials='G.' surname='Klyne' fullname='G. Klyne'>
<organization /></author>
<author initials='C.' surname='Newman' fullname='C. Newman'>
<organization /></author>
<date month='July' year='2002' /></front>
<seriesInfo name='RFC' value='3339' />
<format type='TXT' octets='35064' target='ftp://ftp.isi.edu/in-notes/rfc3339.txt' />
</reference>

<reference anchor='DISP'>
<front>
<title abbrev='Content-Disposition'>Communicating Presentation Information in Internet Messages: The Content-Disposition Header Field</title>
<author initials='R.' surname='Troost' fullname='Rens Troost'>
<organization>New Century Systems</organization>
<address>
<postal>
<street>324 East 41st Street #804</street>
<street>New York</street>
<street>NY</street>
<street>10017</street>
<country>USA</country></postal>
<phone>+1 (212) 557-2050</phone>
<facsimile>+1 (212) 557-2049</facsimile>
<email>rens@century.com</email></address></author>
<author initials='S.' surname='Dorner' fullname='Steve Dorner'>
<organization>QUALCOMM Incorporated</organization>
<address>
<postal>
<street>6455 Lusk Boulevard</street>
<street>San Diego</street>
<street>CA 92121</street>
<country>USA</country></postal>
<email>sdorner@qualcomm.com</email></address></author>
<author initials='K.' surname='Moore' fullname='Keith Moore'>
<organization>Department of Computer Science</organization>
<address>
<postal>
<street>University of Tennessee</street>
<street>Knoxville</street>
<street>107 Ayres Hall</street>
<street>Knoxville TN  37996-1301</street>
<country>USA</country></postal>
<phone>+1 (423) 974-5067</phone>
<facsimile>+1 (423) 974-8296</facsimile>
<email>moore@cs.utk.edu</email></address></author>
<date month='August' year='1997' />
<area>Applications</area>
<keyword>MIME</keyword>
<keyword>internet message</keyword>
<keyword>multipurpose internet mail extensions</keyword>
<abstract>
<t>
   This memo provides a mechanism whereby messages conforming to the
   MIME specifications [RFC 2045, RFC 2046, RFC 2047, RFC 2048, RFC
   2049] can convey presentational information.  It specifies the
   "Content-Disposition" header field, which is optional and valid for
   any MIME entity ("message" or "body part").  Two values for this
   header field are described in this memo; one for the ordinary linear
   presentation of the body part, and another to facilitate the use of
   mail to transfer files.  It is expected that more values will be
   defined in the future, and procedures are defined for extending this
    set of values.
</t>
<t>
   This document is intended as an extension to MIME.  As such, the
   reader is assumed to be familiar with the MIME specifications, and
   [RFC 822].  The information presented herein supplements but does not
   replace that found in those documents.
</t>
<t>
   This document is a revision to the Experimental protocol defined in
   RFC 1806.  As compared to RFC 1806, this document contains minor
   editorial updates, adds new parameters needed to support the File
   Transfer Body Part, and references a separate specification for the
   handling of non-ASCII and/or very long parameter values.
</t></abstract></front>
<seriesInfo name='RFC' value='2183' />
<format type='TXT' octets='23150' target='ftp://ftp.isi.edu/in-notes/rfc2183.txt' />
<format type='HTML' octets='38526' target='http://xml.resource.org/public/rfc/html/rfc2183.html' />
<format type='XML' octets='24153' target='http://xml.resource.org/public/rfc/xml/rfc2183.xml' />
</reference>

      <reference anchor="IMP-MODEL" target="http://www.ietf.org/rfc/rfc2778.txt">
        <front>
          <title>A Model for Presence and Instant Messaging</title>
          <author initials="M." surname="Day" fullname="Mark Day">
            <organization>SightPath, Inc.</organization>
            <address>
              <email>mday@alum.mit.edu</email>
            </address>
          </author>
          <author initials="J." surname="Rosenberg" fullname="Jonathan Rosenberg">
            <organization>dynamicsoft</organization>
            <address>
              <email>jdrosen@dynamicsoft.com</email>
            </address>
          </author>
          <author initials="H." surname="Sugano" fullname="Hiroyasu Sugano">
            <organization>Fujitsu Laboratories Ltd.</organization>
            <address>
              <email>suga@flab.fujitsu.co.jp</email>
            </address>
          </author>
          <date month="February" year="2000"/>
        </front>
        <seriesInfo name="RFC" value="2778"/>
      </reference>

      <reference anchor='IMP-REQS'>
        <front>
          <title abbrev='Instant Messaging/Presence Protocol'>Instant Messaging / Presence Protocol Requirements</title>
          <author initials='M.' surname='Day' fullname='Mark Day'>
          <organization>SightPath, Inc.</organization>
          <address>
            <postal>
              <street>135 Beaver Street</street>
              <city>Waltham</city>
              <region>MA</region>
              <code>02452</code>
              <country>US</country>
            </postal>
            <phone></phone>
            <email>mday@alum.mit.edu</email></address>
          </author>
          <author initials='S.' surname='Aggarwal' fullname='Sonu Aggarwal'>
            <organization>Microsoft Corporation</organization>
            <address>
              <postal>
                <street>One Microsoft Way</street>
                <city>Redmond</city>
                <region>WA</region>
                <code>98052</code>
                <country>US</country>
              </postal>
              <phone></phone>
              <email>sonuag@microsoft.com</email>
            </address>
          </author>
          <author initials='J.' surname='Vincent' fullname='Jesse Vincent'>
            <organization>Into Networks, Inc.</organization>
            <address>
              <postal>
                <street>150 Cambridgepark Drive</street>
                <city>Cambridge</city>
                <region>MA</region>
                <code>02140</code>
                <country>US</country>
              </postal>
              <phone></phone>
              <email>jesse@intonet.com</email>
            </address>
          </author>
          <date month='February' year='2000'></date>
          <abstract>
            <t>Presence and Instant Messaging have recently emerged as a new medium of communications over the Internet.  Presence is a means for finding, retrieving, and subscribing to changes in the presence information (e.g.  "online" or "offline") of other users.  Instant messaging is a means for sending small, simple messages that are delivered immediately to online users.</t>
            <t>Applications of presence and instant messaging currently use independent, non-standard and non-interoperable protocols developed by various vendors.  The goal of the Instant Messaging and Presence Protocol (IMPP) Working Group is to define a standard protocol so that independently developed applications of instant messaging and/or   presence can interoperate across the Internet.  This document defines a minimal set of requirements that IMPP must meet.</t>
          </abstract>
        </front>
        <seriesInfo name='RFC' value='2779' />
      </reference>

<reference anchor="MSGFMT">
<front>
<title>Common Presence and Instant Messaging (CPIM): Message Format</title>
<author initials='G.' surname='Klyne' fullname='G. Klyne'>
<organization /></author>
<author initials='D.' surname='Atkins' fullname='D. Atkins'>
<organization /></author>
<date year='2004' month='August' /></front>
<seriesInfo name='RFC' value='3862' />
<format type='TXT' octets='56133' target='ftp://ftp.isi.edu/in-notes/rfc3862.txt' />
</reference>

<reference anchor='MULTI'>
<front>
<title abbrev='Security Multiparts'>Security Multiparts for MIME: Multipart/Signed and Multipart/Encrypted</title>
<author initials='J.' surname='Galvin' fullname='Jim Galvin'>
<organization>Trusted Information Systems</organization>
<address>
<postal>
<street>3060 Washington Road</street>
<city>Glenwood</city>
<region>MD</region>
<code>21738</code>
<country>US</country></postal>
<phone>+1 301 854 6889</phone>
<facsimile>+1 301 854 5363</facsimile>
<email>galvin@tis.com</email></address></author>
<author initials='S.' surname='Murphy' fullname='Sandy Murphy'>
<organization>Trusted Information Systems</organization>
<address>
<postal>
<street>3060 Washington Road</street>
<city>Glenwood</city>
<region>MD</region>
<code>21738</code>
<country>US</country></postal>
<phone>+1 301 854 6889</phone>
<facsimile>+1 301 854 5363</facsimile>
<email>sandy@tis.com</email></address></author>
<author initials='S.' surname='Crocker' fullname='Steve Crocker'>
<organization>CyberCash, Inc.</organization>
<address>
<postal>
<street>2086 Hunters Crest Way</street>
<city>Vienna</city>
<region>VA</region>
<code>22181</code>
<country>US</country></postal>
<phone>+1 703 620 1222</phone>
<facsimile>+1 703 391 2651</facsimile>
<email>crocker@cybercash.com</email></address></author>
<author initials='N.' surname='Freed' fullname='Ned Freed'>
<organization>Innosoft International, Inc.</organization>
<address>
<postal>
<street>1050 East Garvey Avenue South</street>
<city>West Covina</city>
<region>CA</region>
<code>91790</code>
<country>US</country></postal>
<phone>+1 818 919 3600</phone>
<facsimile>+1 818 919 3614</facsimile>
<email>ned@innosoft.com</email></address></author>
<date month='October' year='1995'></date>
<abstract>
<t>This document defines a framework within which security services may be applied to MIME body parts.  MIME, an acronym for "Multipurpose Internet Mail Extensions", defines the format of the contents of Internet mail messages and provides for multi-part textual and non-textual message bodies.  The new content types are subtypes of multipart: signed and encrypted.  Each will contain two body parts: one for the protected data and one for the control information necessary to remove the protection.  The type and contents of the control information body parts are determined by the value of the protocol parameter of the enclosing multipart/signed or multipart/encrypted content type, which is required to be present.</t></abstract></front>
<seriesInfo name='RFC' value='1847' />
</reference>

<reference anchor="PIDF">
<front>
<title>Presence Information Data Format (PIDF)</title>
<author initials='H.' surname='Sugano' fullname='H. Sugano'>
<organization /></author>
<author initials='S.' surname='Fujimoto' fullname='S. Fujimoto'>
<organization /></author>
<author initials='G.' surname='Klyne' fullname='G. Klyne'>
<organization /></author>
<author initials='A.' surname='Bateman' fullname='A. Bateman'>
<organization /></author>
<author initials='W.' surname='Carr' fullname='W. Carr'>
<organization /></author>
<author initials='J.' surname='Peterson' fullname='J. Peterson'>
<organization /></author>
<date year='2004' month='August' /></front>
<seriesInfo name='RFC' value='3863' />
<format type='TXT' octets='56956' target='ftp://ftp.isi.edu/in-notes/rfc3863.txt' />
</reference>

<reference anchor='SMIME'>
<front>
<title>Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 3.1 Message Specification</title>
<author initials='B.' surname='Ramsdell' fullname='B. Ramsdell'>
<organization /></author>
<date year='2004' month='July' /></front>
<seriesInfo name='RFC' value='3851' />
<format type='TXT' octets='53328' target='ftp://ftp.isi.edu/in-notes/rfc3851.txt' />
</reference>

      <reference anchor='TERMS'>
        <front>
          <title abbrev='RFC Key Words'>Key words for use in RFCs to Indicate Requirement Levels</title>
          <author initials='S.' surname='Bradner' fullname='Scott Bradner'>
            <organization>Harvard University</organization>
            <address>
              <postal>
                <street>1350 Mass.  Ave.</street>
                <street>Cambridge</street>
                <street>MA 02138</street>
              </postal>
              <phone>- +1 617 495 3864</phone>
              <email>-</email>
            </address>
          </author>
          <date month='March' year='1997'></date>
          <area>General</area>
          <keyword>keyword</keyword>
          <abstract>
            <t>In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized.  This document defines these words as they should be interpreted in IETF documents.  Authors who follow these guidelines should incorporate this phrase near the beginning of their document: 
              <list>
                <t>The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;, &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;,  &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this document are to be interpreted as described in RFC 2119.</t>
              </list>
            </t>
            <t>Note that the force of these words is modified by the requirement level of the document in which they are used.</t>
          </abstract>
        </front>
        <seriesInfo name='BCP' value='14' />
        <seriesInfo name='RFC' value='2119' />
      </reference>

<reference anchor='XML-MEDIA'>
<front>
<title>XML Media Types</title>
<author initials='M.' surname='Murata' fullname='M. Murata'>
<organization /></author>
<author initials='S.' surname='St. Laurent' fullname='S. St. Laurent'>
<organization /></author>
<author initials='D.' surname='Kohn' fullname='D. Kohn'>
<organization /></author>
<date year='2001' month='January' /></front>
<seriesInfo name='RFC' value='3023' />
<format type='TXT' octets='86011' target='ftp://ftp.isi.edu/in-notes/rfc3023.txt' />
</reference>

<reference anchor='XMPP-CORE'>
  <front>
    <title>Extensible Messaging and Presence Protocol (XMPP): Core</title>
    <author initials='P.' surname='Saint-Andre' fullname='P. Saint-Andre'>
      <organization>Jabber Software Foundation</organization>
    </author>
    <date year='2004' month='October' />
  </front>
  <seriesInfo name='RFC' value='3920' />
  <format type='TXT' octets='194313' target='ftp://ftp.isi.edu/in-notes/rfc3920.txt' />
</reference>

<reference anchor='XMPP-IM'>
  <front>
    <title>Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence</title>
    <author initials='P.' surname='Saint-Andre' fullname='P. Saint-Andre'>
      <organization>Jabber Software Foundation</organization>
    </author>
    <date year='2004' month='October' />
  </front>
  <seriesInfo name='RFC' value='3921' />
  <format type='TXT' octets='217527' target='ftp://ftp.isi.edu/in-notes/rfc3921.txt' />
</reference>

    </references>

    <references title="Informative References">

<reference anchor="CAPS">
  <front>
    <title>Entity Capabilities</title>
    <author initials="J." surname="Hildebrand" fullname="Joe Hildebrand">
      <organization/>
      <address>
        <email>jhildebrand@jabber.com</email>
      </address>
    </author>
    <author initials="P." surname="Saint-Andre" fullname="Peter Saint-Andre">
      <organization/>
      <address>
        <email>stpeter@jabber.org</email>
      </address>
    </author>
    <date day="01" month="August" year="2004"/>
  </front>
  <seriesInfo name="XSF XEP" value="0115"/>
  <format type="HTML" target="http://www.jabber.org/jeps/jep-0115.html"/>
</reference>

<reference anchor='CMC'>
<front>
<title>Certificate Management Messages over CMS</title>
<author initials='M.' surname='Myers' fullname='Michael Myers'>
<organization>VeriSign Inc.</organization>
<address>
<postal>
<street>1350 Charleston Road</street>
<city>Mountain View</city>
<region>CA</region>
<code>94043</code>
<country>US</country></postal>
<phone>+1 650 429 3402</phone>
<email>mmyers@verisign.com</email></address></author>
<author initials='X.' surname='Liu' fullname='Xiaoyi Liu'>
<organization>cisco Systems</organization>
<address>
<postal>
<street>170 West Tasman Drive</street>
<city>San Jose</city>
<region>CA</region>
<code>95134</code>
<country>US</country></postal>
<phone>+1 480 526 7430</phone>
<email>xliu@cisco.com</email></address></author>
<author initials='J.' surname='Schaad' fullname='Jim Schaad'>
<organization />
<address>
<email>jimsch@nwlink.com</email></address></author>
<author initials='J.' surname='Weinstein' fullname='Jeff Weinstein'>
<organization />
<address>
<email>jsw@meer.net</email></address></author>
<date year='2000' month='April' />
<abstract>
<t>This document defines a Certificate Management protocol using CMS. This protocol addresses two immediate needs within the Internet PKI community:</t>
<t>1. The need for an interface to public key certification products and services based onand, and 
2. The need infor a certificate enrollment protocol for DSA-signed certificates with Diffie-Hellman public keys.</t>
<t>A small number of additional services are defined to supplement the core certificate request service.</t>
<t>Throughout this specification the term CMS is used to refer to bothand.  For both signedData and envelopedData, CMS is a superset of the PKCS7. In general, the use of PKCS7 in this document is aligned to the Cryptographic Message Syntaxthat provides a superset of the PKCS7 syntax. The term CMC refers to this specification.</t>
<t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in [RFC 2119].</t></abstract></front>
<seriesInfo name='RFC' value='2797' />
<format type='TXT' octets='103357' target='ftp://ftp.isi.edu/in-notes/rfc2797.txt' />
</reference>

<reference anchor='CMP'>
<front>
<title abbrev='PKI Certificate Management Protocols'>Internet X.509 Public Key Infrastructure Certificate Management Protocols</title>
<author initials='C.' surname='Adams' fullname='Carlisle Adams'>
<organization>Entrust Technologies</organization>
<address>
<postal>
<street>750 Heron Road</street>
<street>Suite E08</street>
<city>Ottawa</city>
<region>Ontario</region>
<code>K1V 1A7</code>
<country>CA</country></postal>
<email>cadams@entrust.com</email></address></author>
<author initials='S.' surname='Farrell' fullname='Stephen Farrell'>
<organization>Software and Systems Engineering Ltd.</organization>
<address>
<postal>
<street>Fitzwilliam Court</street>
<street>Leeson Close</street>
<city>Dublin</city>
<region />
<code>2</code>
<country>IE</country></postal>
<email>stephen.farrell@sse.ie</email></address></author>
<date month='March' year='1999' />
<abstract>
<t>This document describes the Internet X.509 Public Key Infrastructure (PKI) Certificate Management Protocols. Protocol messages are defined for all relevant aspects of certificate creation and management. Note that "certificate" in this document refers to an X.509v3 Certificate as defined in,</t>
<t>The key words "MUST", "MUST NOT", "REQUIRED", "SHOULD", "SHOULD NOT",  "RECOMMENDED", "MAY", and "OPTIONAL" in this document (in uppercase, as shown) are to be interpreted as described in.</t></abstract></front>
<seriesInfo name='RFC' value='2510' />
<format type='TXT' octets='158178' target='ftp://ftp.isi.edu/in-notes/rfc2510.txt' />
</reference>

<reference anchor="DISCO">
  <front>
    <title>Service Discovery</title>
    <author initials="J." surname="Hildebrand" fullname="Joe Hildebrand">
      <organization/>
      <address>
        <email>jhildebrand@jabber.com</email>
      </address>
    </author>
    <author initials="P." surname="Millard" fullname="Peter Millard">
      <organization/>
      <address>
        <email>pgmillard@jabber.org</email>
      </address>
    </author>
    <author initials="R." surname="Eatmon" fullname="Ryan Eatmon">
      <organization/>
      <address>
        <email>reatmon@jabber.org</email>
      </address>
    </author>
    <author initials="P." surname="Saint-Andre" fullname="Peter Saint-Andre">
      <organization/>
      <address>
        <email>stpeter@jabber.org</email>
      </address>
    </author>
    <date day="20" month="July" year="2004"/>
  </front>
  <seriesInfo name="XSF JEP" value="0030"/>
  <format type="HTML" target="http://www.jabber.org/jeps/jep-0030.html"/>
</reference>

<reference anchor="HMAC">
  <front>
    <title>The Keyed-Hash Message Authentication Code (HMAC): Federal Information Processing Standards Publication 198</title>
    <author/>
  </front>
</reference>

<reference anchor="MUC">
  <front>
    <title>Multi-User Chat</title>
    <author initials="P." surname="Saint-Andre" fullname="Peter Saint-Andre">
      <organization/>
      <address>
        <email>stpeter@jabber.org</email>
      </address>
    </author>
    <date day="30" month="June" year="2004"/>
  </front>
  <seriesInfo name="XSF JEP" value="0045"/>
  <format type="HTML" target="http://www.jabber.org/jeps/jep-0045.html"/>
</reference>

<reference anchor="XML" target="http://www.w3.org/TR/REC-xml">
  <front>
    <title abbrev="XML">Extensible Markup Language (XML) 1.0 (3rd ed)</title>
    <author initials="T." surname="Bray" fullname="Tim Bray">
      <organization>Textuality and Netscape</organization>
      <address>
        <email>tbray@textuality.com</email>
      </address>
    </author>
    <author initials="J." surname="Paoli" fullname="Jean Paoli">
      <organization>Microsoft</organization>
      <address>
        <email>jeanpa@microsoft.com</email>
      </address>
    </author>
    <author initials="C.M." surname="Sperberg-McQueen" fullname="C.  M.  Sperberg-McQueen">
      <organization>University of Illinois at Chicago and Text Encoding Initiative</organization>
      <address>
        <email>cmsmcq@uic.edu</email>
      </address>
    </author>
    <author initials="E." surname="Maler" fullname="Eve Maler">
      <organization>Sun Microsystems</organization>
      <address>
        <email>eve.maler@east.sun.com</email>
      </address>
    </author>
    <date day="4" month="February" year="2004"/>
  </front>
  <seriesInfo name="W3C" value="REC-xml"/>
</reference>

<reference anchor="XML-REG">
<front>
<title>The IETF XML Registry</title>
<author initials='M.' surname='Mealling' fullname='M. Mealling'>
<organization /></author>
<date month='January' year='2004' /></front>
<seriesInfo name='BCP' value='81' />
<seriesInfo name='RFC' value='3688' />
<format type='TXT' octets='17325' target='ftp://ftp.isi.edu/in-notes/rfc3688.txt' />
</reference>

    </references>

    <section title="Schema for urn:ietf:params:xml:ns:xmpp-objenc" anchor="schemas-e2e">
      <t>The following XML schema is descriptive, not normative.</t>
      <figure>
        <artwork><![CDATA[
<?xml version='1.0' encoding='UTF-8'?>

<xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='urn:ietf:params:xml:ns:xmpp-objenc'
    xmlns='urn:ietf:params:xml:ns:xmpp-objenc'
    elementFormDefault='qualified'>

  <xs:element name='e2e' type='xs:string'/>

  <xs:element name='decryption-failed' type='empty'/>
  <xs:element name='signature-unverified' type='empty'/>
  <xs:element name='bad-timestamp' type='empty'/>

  <xs:simpleType name='empty'>
    <xs:restriction base='xs:string'>
      <xs:enumeration value=''/>
    </xs:restriction>
  </xs:simpleType>

</xs:schema>
        ]]></artwork>
      </figure>
    </section>

  </back>

</rfc>
